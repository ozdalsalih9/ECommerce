@model E_Commerse.Core.Entities.Product

@{
    ViewData["Title"] = Model.Name;
}


<div class="product-detail-container">
    <div class="product-content">
        <div class="product-gallery">
            <div class="main-image-container">
                <img src="/img/Products/MainImage/@Model.Image" alt="@Model.Name" class="main-image" id="mainImage" />
            </div>
            <div class="thumbnail-slider" id="thumbnailSlider">
                <img src="/img/Products/MainImage/@Model.Image" alt="@Model.Name"
                     class="thumbnail active"
                     onclick="changeMainImage(this, '/img/Products/MainImage/@Model.Image')" />
                @foreach (var image in Model.ProductImages)
                {
                    <img src="/img/Products/OtherImages/@image.ImagePath" alt="@Model.Name"
                         class="thumbnail"
                         onclick="changeMainImage(this, '/img/Products/OtherImages/@image.ImagePath')" />
                }
            </div>
        </div>
        <div class="product-info">
            <h1 class="product-title">@Model.Name</h1>
            <div class="product-meta">Ürün Kodu: @Model.ProductCode</div>
            <div class="size-selection">
                <label class="fw-bold mb-2 d-block">Beden Seçiniz:</label>
                <select id="sizeSelect" class="form-select">
                    <option value="">-- Beden Seçin --</option>
                    @foreach (var size in Model.ProductSizes)
                    {
                        <option value="@size.SizeId" data-stock="@size.Stock">
                            @size.Size.Name @(size.Stock < 10 ? $"(Son {size.Stock} adet)" : "")
                        </option>
                    }
                </select>
                <div id="stockMessage" class="stock-message mt-2"></div>
            </div>
            @if (Model.ProductColors != null && Model.ProductColors.Any())
            {
                <div>
                    <h4>Renkler</h4>
                    <div id="colorOptions" style="display:flex; gap:10px; margin-bottom: 1rem;">
                        @foreach (var pc in Model.ProductColors)
                        {
                            <div class="color-circle"
                                 data-color-id="@pc.ColorId"
                                 title="@pc.Color.Name"
                                 style="width: 30px; height: 30px; border-radius: 50%; background-color:@pc.Color.Code; border: 2px solid transparent; cursor: pointer;"
                                 onclick="selectColor(this)">
                            </div>
                        }
                    </div>
                    <div id="colorImagesContainer" style="display:flex; gap:10px; flex-wrap: wrap;">
                        <!-- Seçilen renk resimleri buraya gelecek -->
                    </div>
                </div>
            }
            <!-- Product-info bölümüne ekleyin (price div'inin altına uygun) -->
            <div class="favorite-section mt-3 mb-3">
                @if (User.Identity.IsAuthenticated)
                {
                    <button id="favoriteToggle"
                            class="btn @(ViewBag.IsFavorite ? "btn-danger" : "btn-outline-danger")"
                            data-product-id="@Model.Id"
                            data-favorite-id="@(ViewBag.FavoriteId ?? 0)">
                        <i class="fas @(ViewBag.IsFavorite ? "fa-heart" : "fa-heart-o")"></i>
                        @(ViewBag.IsFavorite ? "Favorilerden Çıkar" : "Favorilere Ekle")
                    </button>
                    <span id="favoriteStatusMessage" class="ms-2 small text-muted"></span>
                }
                else
                {
                    <a asp-action="SignIn" asp-controller="Account" class="btn btn-outline-secondary">
                        <i class="fas fa-heart-o"></i> Favorilere eklemek için giriş yapın
                    </a>
                }
            </div>


            <div class="product-description">
                <h3 class="section-title">ÜRÜN AÇIKLAMASI</h3>
                <p class="text-muted">@Model.Description</p>
            </div>
        </div>
    </div>


    @if (ViewBag.RelatedProducts != null && ViewBag.RelatedProducts.Count > 0)
    {
        <div class="related-products">
            <h2 class="section-title">BENZER ÜRÜNLER</h2>
            <div class="related-products-grid">
                @foreach (var product in ViewBag.RelatedProducts)
                {
                    <div class="product-card">
                        <div class="product-card-img">
                            <img src="/img/Products/MainImage/@product.Image" alt="@product.Name" />
                        </div>
                        <div class="product-card-body">
                            <h4 class="product-card-title">@product.Name</h4>
                            <div class="product-card-price">@product.Price.ToString("C")</div>
                            <a asp-action="Details" asp-route-id="@product.Id" class="product-card-link">İncele</a>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
</div>
<div id="imageModal" style="
    display:none;
    position: fixed;
    z-index: 1050;
    left: 0; top: 0;
    width: 100%; height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.8);
    text-align: center;
">
    <span id="modalClose" style="
        position: absolute;
        top: 20px;
        right: 35px;
        color: white;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;">&times;</span>
    <img id="modalImg" src="" style="
        margin-top: 50px;
        max-width: 90%;
        max-height: 80vh;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(255,255,255,0.5);
    " />
</div>
